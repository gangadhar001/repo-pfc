\subsection{Quinta iteración} 

Siguiendo los casos de uso de la funcionalidad de \textit{Exportar información} (ver Figura \ref{fig:CduExportarConocimiento2Server}) y \textit{Gestión de idiomas} (ver Figura \ref{fig:CduGestionIdiomas2Server}), así como el análisis realizado, se abordan las siguientes tareas en esta iteración:

\begin{itemize}
	\item Diseño de la funcionalidad relativa a la gestión de idiomas y a exportar la información de las decisiones.
	\item Implementación de dichas funcionalidades.
	\item Diseño e implementación de pruebas unitarias y funcionales relativas a la gestión de idiomas y a exportar la información de las decisiones.
\end{itemize}


\subsubsection{Funcionalidad de \textit{Exportar conocimiento}} \label{sec:exportarConocimiento}

\paragraph{Diagramas de secuencia}

En la Figura \ref{fig:secuenciaExportarConocimientoCliente} se muestra el diagrama de secuencia para el caso de uso \textit{Adjuntar ficheros} en el cliente, mientras que en la Figura \ref{fig:secuenciaExportarConocimientoServer} se muestra el diagrama de secuencia para el servidor.

%\imagen{Cap5/Cliente2//secuenciaConsultarNotificacionCliente}{1.0}{Diagrama de secuencia - Cliente - Consultar notificaciones ficheros}{fig:secuenciaConsultarNotificacionCliente}

%\imagen{Cap5/Server2//secuenciaConsultarNotificacionServer}{1.0}{Diagrama de secuencia - Servidor - Consultar notificaciones}{fig:secuenciaConsultarNotificacionServer}



\paragraph{Diseño e implementación}

\subparagraph{Servidor}

En el diseño e implementación de esta funcionalidad, cabe destacar la utilización de \textbf{JAXB} (ver sección \ref{sec:marco}) para serializar las clases que componen la jerarquía de decisiones y toda su información relacionada (ver Figura \ref{fig:clasesKnowledge}) a un archivo XML. Para ello, se utilizan anotaciones sobre las clases, indicando que esa clase y sus atributos deben convertirse a un nodo XML. Además, es necesario que exista una clase que represente al nodo raíz del fichero XML y que, por tanto, contenga toda la lista de decisiones. Dicha clase, como ya se ha comentado anteriormente, es la clase llamada \textit{TopicWrapper}.

En el fragmento de código \ref{list:JAXBTopics} se muestran las anotaciones de JAXB realizadas sobre la clase \textit{TopicWrapper}, que engloba a todos los \textit{topics} de un proyecto. En el fragmento de código \ref{list:JAXBKnowledge} se muestran las anotaciones de JAXB para la clase \textit{Knowledge}, para poder serializar sus atributos. Del mismo modo se realizan las anotaciones en el resto de clases que componen el diagrama de clases mostrado en la Figura \ref{fig:clasesKnowledge}.

\texttt{\lstinputlisting[caption=Anotaciones de JAXB sobre la clase \textit{TopicWrapper}, breaklines=true, label=list:JAXBTopics, inputencoding=latin1, style=JavaStyle]{Codigo//JAXBTopics.java}}

\texttt{\lstinputlisting[caption=Anotaciones de JAXB sobre la clase \textit{Knowledge}, breaklines=true, label=list:JAXBKnowledge, inputencoding=latin1, style=JavaStyle]{Codigo//JAXBKnowledge.java}}


\subparagraph{Cliente}

%% DESTACAR COMO MANDAR LA RUTA A GUARDAR O COMO SE GUARDA


\paragraph{Pruebas}



\subsubsection{Funcionalidad de \textit{Gestión de idiomas}}

\paragraph{Diagramas de secuencia}

En la Figura \ref{fig:secuenciaCambiarIdiomaCliente} se muestra el diagrama de secuencia para el caso de uso \textit{Adjuntar ficheros} en el cliente, mientras que en la Figura \ref{fig:secuenciaCambiarIdiomaServer} se muestra el diagrama de secuencia para el servidor.


\imagen{Cap5/Cliente2//secuenciaCambiarIdiomaCliente}{0.6}{Diagrama de secuencia - Cliente - Gestión de idiomas}{fig:secuenciaCambiarIdiomaCliente}

\imagen{Cap5/Server2//secuenciaCambiarIdiomaServer}{2.0}{Diagrama de secuencia - Servidor - Gestión de idiomas}{fig:secuenciaCambiarIdiomaServer}


\paragraph{Diseño e implementación}

Ambos subsistemas, tanto el cliente como el servidor, deben soportar multi-idioma, por lo que se ha diseñado e implementado un gestor de lenguajes. Dicho gestor será el encargado de, según el idioma elegido en la aplicación, mostrar la diferente información de la interfaz gráfica de usuario en ese idioma. Para ello, se han creado ficheros de propiedades (o \textit{properties)} que contienen las cadenas de texto a internacionalizar, utilizando uno u otro según el idioma escogido. El nombre de dichos ficheros terminan con el código del idioma de cada país, para poder cargar uno u otro según el idioma.

En el fragmento de código \ref{list:internacionalizacion} se muestra cómo utilizar los archivos \textit{properties} para dar soporte al multi-idioma.

\texttt{\lstinputlisting[caption=Soporte multi-idioma, breaklines=true, label=list:internacionalizacion, inputencoding=latin1, style=JavaStyle]{Codigo//internacionalizacion.java}}

Para terminar, señalar que los idiomas disponibles para configurar la aplicación se encuentran un fichero XML, para que no sea necesario una conexión a base de datos y se pueda modificar el idioma de la aplicación sin tener que acceder previamente a dicha base de datos. Además, se facilita la extensibilidad y adición de nuevos idiomas, ya que sólo abría que crear su fichero de propiedades y agregar ese idioma al fichero XML.


\paragraph{Pruebas}

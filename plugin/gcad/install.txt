DROP DATABASE bdgcad;
CREATE DATABASE bdgcad CHARACTER SET utf8 COLLATE utf8_bin;
USE bdgcad;

CREATE TABLE projects (
       id INT NOT NULL AUTO_INCREMENT,
       name VARCHAR(255) UNIQUE NOT NULL default '',
       description VARCHAR(255) NOT NULL default '', 
       bullet DOUBLE NOT NULL,
       startDate DATETIME NOT NULL,
       endDate DATETIME NOT NULL,
       PRIMARY KEY (id)
) TYPE=InnoDB AUTO_INCREMENT=1;

CREATE TABLE employees (
	   id INT NOT NULL AUTO_INCREMENT,
       nif CHAR(9) UNIQUE NOT NULL, 
       login VARCHAR(255) UNIQUE NOT NULL default '',
       password VARCHAR(255) NOT NULL default '', 
       rol INT NOT NULL default '-1',
       name VARCHAR(255) NOT NULL default '',
       surname VARCHAR(255) NOT NULL default '',
       email VARCHAR(255) default '',
       telephone VARCHAR(9) default '',
       projectId INT default '-1',
       PRIMARY KEY (id),
       FOREIGN KEY (projectId) REFERENCES projects (id) ON DELETE SET NULL ON UPDATE CASCADE
) TYPE=InnoDB AUTO_INCREMENT=1;

CREATE TABLE proposals (
       id INT NOT NULL AUTO_INCREMENT,
       name VARCHAR(255) NOT NULL default '',
       description VARCHAR(255) NOT NULL default '', 
       date DATETIME NOT NULL,
       category ENUM ('Analysis', 'Design') NOT NULL,
       projectId INT default '-1',
       employeeId INT default '-1',
       parentProposal INT default NULL,
       PRIMARY KEY (id),
       FOREIGN KEY (projectId) REFERENCES projects (id) ON DELETE CASCADE ON UPDATE CASCADE,
       FOREIGN KEY (employeeId) REFERENCES employees (id) ON DELETE CASCADE ON UPDATE CASCADE,
       FOREIGN KEY (parentProposal) REFERENCES proposals (id) ON DELETE CASCADE ON UPDATE CASCADE
) TYPE=InnoDB AUTO_INCREMENT=1;

CREATE TABLE answers (
       id INT NOT NULL AUTO_INCREMENT,
       name VARCHAR(255) NOT NULL default '',
       description VARCHAR(255) NOT NULL default '', 
       date DATETIME NOT NULL,
       argument ENUM ('pro', 'contra') NOT NULL,
       employeeId INT default '-1',
       proposalId INT default '-1',
       PRIMARY KEY (id),
       FOREIGN KEY (employeeId) REFERENCES employees (id) ON DELETE CASCADE ON UPDATE CASCADE,
       FOREIGN KEY (proposalId) REFERENCES proposals (id) ON DELETE CASCADE ON UPDATE CASCADE
) TYPE=InnoDB AUTO_INCREMENT=1;
   
INSERT INTO projects (name, description, bullet, startDate, endDate)
   VALUES ("Project1", "Proyecto de Prueba 1", 20000.5, "2002-03-05", "2012-12-31");
INSERT INTO projects (name, description, bullet, startDate, endDate)
   VALUES ("Project2", "Proyecto de Prueba 2", 2123414, "2000-01-01", "2010-12-31");

INSERT INTO employees (nif, login, password, rol, name, surname, email, telephone, projectId)
   VALUES ("06941082A", "emp1", "emp1", 0, "Juan", "López Moreno", "juanlo10@gmail.com", "926119834", 1);
INSERT INTO employees (nif, login, password, rol, name, surname, email, telephone, projectId)
   VALUES ("58123457B", "emp2", "emp2", 1, "Antonio", "Ejemplo Moreno", "asfsaf@gmail.com", "926119834", 2);
INSERT INTO employees (nif, login, password, rol, name, surname, email, telephone, projectId)
   VALUES ("01921318C", "emp3", "emp3", 0, "Eva", "Perez Moreno", "bvcsa@gmail.com", "926119834", 1);
   
INSERT INTO proposals (name, description, date, category, projectId, employeeId, parentProposal)
   VALUES ("Proposal 1", "Propuesta 1 raiz", "2010-11-15", "Analysis", 1, 1, null);
INSERT INTO proposals (name, description, date, category, projectId, employeeId, parentProposal)
   VALUES ("Proposal 2", "Propuesta 2 hija de 1", "2010-11-18", "Analysis", 1, 3, 1);
INSERT INTO proposals (name, description, date, category, projectId, employeeId, parentProposal)
   VALUES ("Proposal 3", "Propuesta 3 raiz", "2010-11-30", "Design", 2, 2, null);
INSERT INTO proposals (name, description, date, category, projectId, employeeId, parentProposal)
   VALUES ("Proposal 4", "Propuesta 4 raiz", "2010-11-30", "Design", 2, 1, null);

INSERT INTO answers (name, description, date, argument, employeeId, proposalId)
   VALUES ("Answer 1", "Respuesta de propuesta 1", "2010-11-15", "pro", 2, 1);
INSERT INTO answers (name, description, date, argument, employeeId, proposalId)
   VALUES ("Answer 2", "Respuesta de propuesta 2", "2010-11-20", "contra", 1, 2);
INSERT INTO answers (name, description, date, argument, employeeId, proposalId)
   VALUES ("Answer 3", "Respuesta de propuesta 2", "2010-11-20", "pro", 3, 2);
INSERT INTO answers (name, description, date, argument, employeeId, proposalId)
   VALUES ("Answer 4", "Respuesta de propuesta 3", "2010-11-15", "pro", 3, 3);
   
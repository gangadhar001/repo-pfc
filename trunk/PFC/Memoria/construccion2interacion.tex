\subsection{Tercera iteración} 

Durante esta iteración, se diseñan, implementan y prueban los casos de uso que componen la funcionalidad de \textit{Gestión de deciciones}, mostrados en la Figura \ref{fig:CduGestiónDecisionesServer}, y la funcionalidad de \textit{Gestión de notificaciones} (ver Figura \ref{fig:CduGestionNotificacionesServer}).

\subsubsection{Funcionalidad de \textit{Gestión de decisiones}}

\paragraph{Diagramas de secuencia}

En los siguientes apartados se muestran los diagramas de secuencia para el cliente y servidor de los casos de uso que componen esta funcionalidad. Dichos diagramas se modelan siguiendo la descripción de los casos de uso realizada en el apartado \ref{sec:analisis}.

\subparagraph{Crear decisión}

En las Figuras \ref{fig:secuenciaCrearTopicCliente}, \ref{fig:secuenciaCrearProposalCliente} y \ref{fig:secuenciaCrearAnswerCliente} se muestran los diagramas de secuencia para el caso de uso \textit{Crear decisión} en el subsistema cliente, mientras que en la Figura \ref{fig:secuenciaCrearDecisionServer} se muestra el diagrama de secuencia para el servidor. Señalar que en el caso del subsistema cliente, se han creado tres diagramas de secuencia, para representar los diferentes actores (o roles en el sistema) que participan en el caso de uso \textit{crear decisión}, según el tipo de decisión. En el servidor, sin embargo, no es necesario separarlo, ya que la secuencia de acciones a realizar es la misma, independientemente del tipo de decisión creada.


%\imagen{Cap5/Cliente2//secuenciaCrearTopicCliente}{1.0}{Diagrama de secuencia - Cliente - Crear decisión (\textit{Topic})}{fig:secuenciaCrearTopicCliente}

%\imagen{Cap5/Cliente2//secuenciaCrearProposalCliente}{1.0}{Diagrama de secuencia - Cliente - Crear decisión (\textit{Topic})}{fig:secuenciaCrearProposalCliente}

%\imagen{Cap5/Cliente2//secuenciaCrearAnswerCliente}{1.0}{Diagrama de secuencia - Cliente - Crear decisión (\textit{Topic})}{fig:secuenciaCrearAnswerCliente}

%\imagen{Cap5/Server2//secuenciaCrearDecisionServer}{1.0}{Diagrama de secuencia - Servidor - Crear decisión}{fig:secuenciaCrearDecisionServer}

\paragraph{Diseño e implementación}

\subparagraph{Servidor}

En el diseño e implementación de esta funcionalidad, cabe destacar la creación de una alerta o notificación de manera automática por parte del servidor. Dicha alerta se crea para el proyecto en el cuál se ha creado la nueva decisión, y para todos los usuarios que en dicho proyecto participan. De este modo, se notifica a los empleados que trabajan en ese proyecto que nuevo conocimiento está disponible, indicando en la alerta el tipo de decisión creada, su autor, fecha, y otros detalles. Ésto facilita la comunicación asíncrona, ya que cuando un usuario vuelva a iniciar sesión, podrá comprobar sus nuevas alertas y adquirir conciencia de los cambios y nuevo conocimiento disponible.

En la Figura \ref{fig:clasesGestionDecisiones} se muestra el diagrama de clases para la funcionalidad de gestión de decisiones, mostrando las asociaciones entre clases y entre los controladores de decisiones y de notificaciones.

Como en el resto de casos, la inserción de las decisiones creadas y de sus correspondientes notificaciones se delega en el gestor de bases de datos y éste, a su vez, delega las operaciones de la base de datos en el framework \textbf{Hibernate}.

También cabe destacar otra decisión de diseño que se ha tenido en cuenta para implementar otro de los requisitos del sistema, que es la comunicación síncrona. Para ello, cuando un cliente crea una decisión y la envía al servidor para su almacenamiento, éste, además de crear la alerta, notifica a los clientes conectados que se ha producido un cambio, para que éstos puedan actualizar su vista de la interfaz gráfica y puedan reflejar esta nueva decisión en tiempo real. Para ello, el servidor lanza un hilo por cada uno de los clientes registrados en el sistema y les envía esta nueva decisión. Se utilizan hilos para no bloquear el servidor mientras manda actualizaciones a los clientes y pueda seguir atendiendo otras peticiones. 

La clase controladora encargada de realizar esta tarea constituye además un patrón observador, el cuál se utiliza para registrar los clientes autenticados en el sistema y notificar y actualizar su estado. En el diagrama de la Figura \ref{fig:clasesObservadorClientes} se muestra este patrón y las clases que lo forman.

En el fragmento de código \ref{list:observador} se muestra parte de la implementación de la clase controlador de los clientes, y en el fragmento \ref{list:hilos} como se ha implementado la gestión de hilos para notificar a los clientes. La clase encarga de esto además representa un patrón proxy, ya que los clientes son remotos.

\texttt{\lstinputlisting[caption=Fragmento de código del controlador de clientes, breaklines=true, label=list:observador, inputencoding=latin1, style=JavaStyle]{Codigo//observadorClientes.java}}

\texttt{\lstinputlisting[caption=Soporte multi-hilo para actualizar el estado de clientes, breaklines=true, label=list:hilos, inputencoding=latin1, style=JavaStyle]{Codigo//hilos.java}}

\subparagraph{Cliente}




%% QUIZAS EN EL RESTO NO PONER DIAGRAMAS, PORQUE ES EL MISMO FLUJO


\subsubsection{Funcionalidad de \textit{Gestión de notificaciones}}

\paragraph{Diagramas de secuencia}

\subparagraph{Consultar notificaciones}

En la Figura \ref{fig:secuenciaCrearTopicCliente}, \ref{fig:secuenciaCrearProposalCliente} y \ref{fig:secuenciaCrearAnswerCliente} se muestran los diagramas de secuencia para el caso de uso \textit{Crear decisión} en el subsistema cliente, mientras que en la Figura \ref{fig:secuenciaCrearDecisionServer} se muestra el diagrama de secuencia para el servidor. Señalar que en el caso del subsistema cliente, se han creado tres diagramas de secuencia, para representar los diferentes actores (o roles en el sistema) que participan en el caso de uso \textit{crear decisión}, según el tipo de decisión. En el servidor, sin embargo, no es necesario separarlo, ya que la secuencia de acciones a realizar es la misma, independientemente del tipo de decisión creada.
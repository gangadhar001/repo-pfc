\subsection{Iteración 6} 

Siguiendo los casos de uso del grupo funcional \textbf{F5:} \textit{Gestión de proyectos} (ver Figura \ref{fig:CduGestionProyectos2Server}), se abordan las siguientes tareas en esta iteración:

\begin{itemize}
	\item Análisis de los casos de uso.
	\item Diseño de la funcionalidad relativa a la gestión de proyectos.
	\item Implementación de dicha funcionalidad.
	\item Diseño e implementación de pruebas relativas a la gestión de proyectos.
\end{itemize}

\subsubsection{Grupo Funcional \textbf{F5:} \textit{Gestión de proyectos}}

\paragraph{Análisis de casos de uso}

Esta iteración comienza con el análisis de los casos de uso que componen este grupo funcional, resaltando el caso de uso \textit{Aconsejar decisiones}, una de las funcionalidades destacadas del sistema.


\paragraph{Diseño e implementación} \label{sec:gestionProyectos}

Utilizando diagramas de secuencia de diseño, se modela el funcionamiento de los casos de uso que componen este grupo funcional. Para el caso de uso \textit{Crear Proyecto}, su diagrama de secuencia para el subsistema cliente se muestra en la Figura \ref{fig:secuenciaCrearProyectosCliente}, mientras que en la Figura \ref{fig:secuenciaCrearProyectosServer} se muestra el diagrama de secuencia para el servidor. En este caso, para crear un proyecto, es necesario también conocer los empleados de la compañía, para poder asignarle aquellos que deben trabajar en ese proyecto.

\imagen{Cap5/Cliente2//secuenciaCrearProyectosCliente}{2.3}{Diagrama de secuencia - Cliente - Crear proyecto}{fig:secuenciaCrearProyectosCliente}

\imagen{Cap5/Server2//secuenciaCrearProyectosServer}{1.5}{Diagrama de secuencia - Servidor - Crear proyecto}{fig:secuenciaCrearProyectosServer}

Como se ha mencionado anteriormente, es importante destacar el caso de uso \textit{Aconsejar Decisiones}, ya que éste es uno de los requisitos más importantes que el sistema debe cunplir. Así, en la Figura \ref{fig:secuenciaCBRCliente} se muestra el diagrama de secuencia para este caso de uso en el cliente, mientras que en la Figura \ref{fig:secuenciaCBRServer} se observa el diagrama de secuencia para el servidor.

\imagen{Cap5/Cliente2//secuenciaCBRCliente}{2.3}{Diagrama de secuencia - Cliente - Aconsejar decisiones}{fig:secuenciaCBRCliente}

\imagen{Cap5/Server2//secuenciaCBRServer}{1.9}{Diagrama de secuencia - Servidor - Aconsejar decisiones}{fig:secuenciaCBRServer}

Hay que señalar que esta funcionalidad incluye el comportamiento de los casos de uso \textit{Consultar decisiones} y \textit{Consultar proyectos}, por lo que dichos comportamientos se muestran de manera simplificada en estos diagramas de secuencia.

En los siguientes apartados se detallan aspectos de diseño e implementación tenidos en cuenta en este grupo funcional.

\subparagraph{Servidor}

Como se comentó en el modelo de negocio en el apartado \ref{sec:modeloDominio}, cada usuario trabaja en 1 o más proyectos, y en cada proyecto participan varios usuarios, por lo que, como se refleja en los diagramas de secuencia anteriores, para crear y modificar un proyecto hay que asignar los usuarios que en dicho proyecto trabajan. En el diagrama de la Figura \ref{fig:clasesGestionProyecto} se observan las clases que participan en la gestión de proyectos y las asociaciones que existen entre los usuarios y los proyectos, y sus clases controladoras correspondientes.

\imagen{Cap5/Server2//clasesGestionProyecto}{2.0}{Diagrama de secuencia - Servidor - Controlador proyectos}{fig:clasesGestionProyecto}

Sin embargo, en este grupo funcional, lo que cabe destacar es el diseño e implementación del caso de uso de \textit{Aconsejar decisiones}. Este caso de uso representa el requisito de recuperar proyectos similares a uno dado, para poder mostrar las decisiones que en él se tomaron, cuáles fueron aceptadas o rechazadas, etc, para poder tenerlas en cuenta en un nuevo proyecto. De este modo, a partir de un nuevo proyecto, y basándose en proyectos anteriores ya terminados, se recuperan aquellos que sean más similares al proyecto dado y se muestran sus decisiones. Para ello, se utiliza el \textbf{Razonamiento Basado en Casos}, o CBR, detallado en la sección \ref{sec:CBR}.

Cada caso del CBR representará un proyecto, definido por un conjunto de atributos, que serán los utilizados para poder comparar proyectos y calcular la semejanza entre casos.

En lo que respecta al CBR en el subsistema servidor, éste recibe la configuración definida en el cliente, el tipo de algoritmo a utilizar, el proyecto a evaluar y el número de proyectos (o casos) que se desean recuperar y visualizar. Por otro lado, se consultan todos los proyectos del sistema y se almacenan en una lista aquellos que ya han finalizado. 

A continuación, se explican cada uno de estos elementos involucrados en esta funcionalidad de CBR.

\begin{itemize}
	\item Número de proyectos a recuperar, definidos por una variable \textit{k}. Es el número de proyectos similares que se recuperan en la fase de \textit{Recuperación} del CBR. Pueden recuperarse todos los proyectos similares, o sólo algunos, según el valor de \textit{k}.
	\item El proyecto a evaluar es el nuevo proyecto, o caso, del que se desean obtener sus decisiones, basándose en proyectos ya pasados y similares a éste.
	\item La lista de proyectos ya terminados, que componen lo que se llama la \textit{base de casos} en CBR. Son todos los proyectos pasados con los que se calculará la semejanza o similitud con el caso nuevo a evaluar.
	\item El algoritmo a utilizar para calcular la semejanza entre el nuevo caso y cada uno de los casos pasados.
	\item La configuración necesaria para utilizar en los algoritmos de CBR.
\end{itemize}


Cabe destacar este último elemento, que es la configuración utilizada en los algoritmos del CBR. Dicha configuración contiene el conjunto de pesos que los atributos van a tomar al calcular el valor final de la semejanza entre casos. Además contiene, para cada atributo, una función que indica como valorar y comparar ese atributo con los atributos de los diferentes casos, llamada \textit{función de semejanza local}. Dicha función establece como comparar los atributos entre dos casos, devolviendo el valor de semejanza entre esos atributos. Existen tres tipos de esta función:

\begin{itemize}
\item \textbf{Diferencia}: esta función devuelve la diferencia entre dos valores numéricos o fechas. Si los valores son de tipo cadena, devuelve 1 si las cadenas son iguales, o 0 en caso contrario. Para el resto de casos, el resultado se normaliza al intervalo [0,1], de tal modo que son más semejantes si la diferencia entre los valores es más pequeña.
\item \textbf{Igualdad}: función que devuelve 1 si los valores son iguales, y 0 en caso contrario.
\item \textbf{Umbral}: esta función, llamada también \textit{Threshold}, es utilizada para evaluar la semejanza entre los valores de dos atributos, comprobando que la diferencia de los valores es menor a un determinado umbral.
\end{itemize}

En lo que respecta a los algoritmos utilizados para calcular el valor de la semejanza final, o \textit{global}, entre casos, se han diseñado e implementado diferentes algoritmos, basándose en la literatura estudiada y comentada en la sección \ref{sec:CBR}. Dichos algoritmos son:

\begin{itemize}
\item \textbf{Nearest Neighbor}: este algoritmo, conocido también como \textit{NN Method}, calcula el valor de semejanza global entre dos casos realizando la media aritmética de los valores de los atributos. Así, se calcula el sumatorio del producto del valor de cada atributo (calculado por la función de semejanza local) por su peso, y se divide por la suma del peso total de todos los atributos. En la ecuación \ref{eq:media} se muestra esta función de semejanza global utilizada en este algoritmo, siendo \textit{c1} y \textit{c2} los casos a evaluar; $w_i$ el peso de cada atributo, y $sem(att1_i, att2_i)$ el valor de semejanza calculado por la función de semejanza local entre los atributos de ambos casos. 
\item \textbf{Euclidean Distance}; este algoritmo calcula el valor de semejanza global entre dos casos realizando la distancia euclídea de los valores de los atributos. Así, se calcula el sumatorio del producto del valor de cada atributo (calculado por la función de semejanza local) elevado al cuadrado, por su peso. En la ecuación \ref{eq:eucl} se muestra esta función de semejanza global utilizada en este algoritmo, siendo \textit{c1} y \textit{c2} los casos a evaluar; $w_i$ el peso de cada atributo, y $sem(att1_i, att2_i)$ el valor de semejanza calculado por la función de semejanza local entre los atributos de ambos casos. 
\end{itemize}


\begin{equation} \label{eq:media}
	sem(c1, c2) = \sum_{i=1}^n(w_i * sem(att1_i, att2_i)) / \sum_{i=1}^n w_i
 \end{equation}
 
 
\begin{equation} \label{eq:eucl}
	sem(c1, c2) =  \sum_{i=1}^n(w_i * sem(att1_i - att2_i)^2)
\end{equation}


Una vez calculada la semejanza global entre el caso a evaluar (el nuevo proyecto) y cada uno de los proyectos pasados, obteniendo una lista de proyectos con su valor de semejanza, dicha lista se ordena de mayor a menor y se toman los \textit{k} primeros, en caso de haber establecido el valor de \textit{k}. Con ello, termina esta fase del CBR, que es la fase de \textbf{Recuperación}, de la que se encarga el sistema servidor. Acto seguido, esta lista de proyectos, ordenados de mayor a menor semejanza con el nuevo caso a evaluar, se devuelve al cliente.


En la Figura \ref{fig:clasesCBR} se muestra el diagrama de clases de diseño de la funcionalidad del CBR. Como se puede observar, se han diseñado interfaces para implementar las funciones de semejanza local y global. De este modo, se podrían extender estas funciones, añadiendo nuevos métodos de comparación, simplemente implementando estas interfaces, consiguiendo que el controlador de CBR sea extensible a nuevas funciones de semejanza. 

\begin{figure}[!htbp]
 \begin{center}
   \includegraphics[scale=1.95,angle=90]{Cap5/Server2//clasesCBR}
 \caption {Diagrama de clases - Servidor - Razonamiento Basado en Casos}
 \label{fig:clasesCBR}
 \end{center}
 \end{figure}

Para terminar, en el fragmento de código \ref{list:cbr} del Apéndice \ref{appendix:CBR}, se muestra la implementación del algoritmo \textit{NN}, haciendo uso del diseño y elementos comentados anteriormente. Un aspecto a señalar es el uso del API de reflexión de Java, utilizado para acceder a los atributos de un proyecto en tiempo de ejecución.




\subparagraph{Cliente}

Respecto al subsistema cliente, tiene especial interés el diseño e implementación del caso de uso \textit{Solicitar recomendaciones}. A continuación se comentan algunos detalles tenidos en cuenta a la hora del diseño y la implementación, ya que en el Apéndice \ref{sec:manualClient} se muestra paso a paso el proceso que hay que seguir para poder crear la configuración necesaria para ejecutar el CBR.

En primer, al igual que en el subsistema servidor, se ha utilizado el API de reflexión de Java para poder mostrar en la interfaz gráfica los atributos de un proyecto y poder introducir sus valores, creando el proyecto que se desea comparar y evaluar. A continuación, utilizando también reflexión, se ha diseñado otra ventana donde se pueden configurar los pesos de cada atributo y seleccionar el tipo de función de semejanza local a utilizar para cada uno de ellos. Para introducir los pesos, como deben ser valores numéricos entre 0 y 1, se ha utilizado un \textit{slider}, que permite seleccionar de manera sencilla valores en el rango indicado.

De este modo, con la configuración creada, se envían los datos al servidor y se obtiene su respuesta, mostrando todos los datos de los proyectos semejantes obtenidos. Además, para cada uno de esos proyectos, se consultan sus decisiones e información asociada a éstas y se muestran también en la interfaz. Con ello, se completa la fase de \textbf{Reutilización} del CBR.

Así, el jefe de proyecto podría modificar el proyecto inicial (el usado para obtener recomendaciones) con algunos de los datos y decisiones de los proyectos más semejantes, si lo considera oportuno, cerrando así las fases de \textit{Revisión} y \textbf{Almacenamiento} del CBR, ya que ese proyecto actualizado quedaría almacenado en la base de datos.

Para terminar, señalar que gracias a la reflexión de Java, la interfaz gráfica es independiente de los atributos definidos en un proyecto, adaptándose a nuevos atributos que se pudieran añadir a la clase \textit{Proyecto}, sin tener que revisar la implementación de la interfaz. Además, gracias a la estructura de composición de elementos diseñada para la interfaz de usuario, muchos de los paneles y elementos se pueden reutilizar para diferentes casos de uso, como por ejemplo, el panel para introducir los datos de un proyecto, el árbol donde se muestran las decisiones, etc. Esto, como se comentó anteriormente, facilita la reutilización, flexibilidad y extensibilidad del subsistema cliente.


\paragraph{Pruebas}

		
En esta fase, se diseñan los casos de prueba unitarios que componen la \textit{suite} de pruebas utilizada para probar los casos de uso para la gestión de proyectos y CBR. En la Figura \ref{fig:testProyectos} se observa una captura de pantalla de la ejecución de la \textit{suite} de pruebas para probar los métodos del servidor, que posteriormente el cliente invocará. 

\imagen{Cap5/Pruebas//pruebasProjects}{0.8}{\textit{Test Suite} para la gestión de proyectos en el servidor}{fig:testProyectos}

Por otro lado, para comprobar el correcto funcionamiento de la interfaz gráfica de usuario para los casos de uso, se han creado \textit{checklists}, como en casos anteriores, donde se muestra en la Tabla \ref{table:checkCBR}, a modo de ejemplo relevante, parte de la \textit{checklist} utilizada para probar la interfaz asociada al CBR.

\begin{table}[!htbp]%
	\centering
	\begin{tabular}{| >{\arraybackslash}m{4cm} | >{\arraybackslash}m{8cm} | >{\center\arraybackslash}m{2cm} |}
	\hline
		\multicolumn{3}{|c|}{\colorCabecera\textbf{Identificador de funcionalidad}: F5} \\
	\hline
		\multicolumn{1}{|c|}{\colorCabecera\textbf{Caso de prueba}} &
		\multicolumn{1}{|c|}{\colorCabecera\textbf{Descripción}} &
		\multicolumn{1}{|c|}{\colorCabecera\textbf{Resultado}} \\
	\hline
		Mostrar datos proyecto &
		Cuando el usuario selecciona un proyecto, se muestran todos los datos de ese proyecto, rellenando los diferentes \textit{textbox}  &
		\ding{'063} \\
	\hline
		Limpiar datos proyecto &
		Cuando el usuario hace clic en el botón correspondiente, se limpian los datos del proyecto y se vacían los \textit{textbox} &
		\ding{'063} \\
			\hline
		Mostrar atributos del proyecto a configurar &	
		Se muestran al usuario, utilizando reflexión, los atributos del proyecto, para poder configurar sus pesos y demás aspectos utilizados en los algoritmos de CBR &
		\ding{'063} \\
	\hline
		Proporcionar \textit{feedback} al usuario al calcular semejantes &
		Se informa al usuario que la acción para calcular los proyectos semejantes, una vez configurado el algoritmo de CBR, está en progreso y que debe esperar &
		\ding{'063} \\
	\hline 
		Visualizar información y decisiones de proyectos encontrados &
		Se muestra la información de los proyectos encontrados, así como las decisiones tomadas en él en forma de árbol y el porcentaje de semejanza al proyecto inicial &
		\ding{'063} \\
	\hline
		Avanzar/Retroceder en los proyectos semejantes encontrados &
		Cuando el usuario hace clic en el botón para avanzar/retroceder en los proyectos encontrados, se muestra la información y decisiones del proyecto correspondiente, limpiando la información del que previamente estaba visualizándose &
		\ding{'063} \\
		\hline
	\end{tabular}
	\caption{Informe de pruebas para el caso de uso \textit{Aconsejar Decisiones (CBR)}}
	\label{table:checkCBR}
\end{table}